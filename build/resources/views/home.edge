<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pareo |Submit the Stat|</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    @entryPointStyles('app')
    @entryPointScripts('app')
  </head>
  <body>

    @if(auth.isLoggedIn)
      <form action="{{ `/admin` }}" method="get">
        {{ csrfField() }}
        <button class="button is-link" type="submit">Manage</button>
      </form>
    @endif
    
    <h1 class="title">Hurry Up!</h1>

    <p hidden id="unsubmit-reminder">{{ reminderText }}</p>

    <div class="block">
      <button class="button is-success" onclick="copyToClipboard()">Remind Message</button>
    </div>
    @each((user, index) in unsubmitUsers)
      <input onclick="submit(this)" type="checkbox" name={{ user.name }} id={{ user.id }} class="checkbox-input"/>
      <label for={{ user.id }} class="checkbox-label">
        <div class="checkbox-text">
          {{--  <div style="width:320px; height:320px">  --}}
            <img style="border-radius: 20px;" src={{ user.profileImg }} alt={{ user.name }}>
          {{--  </div>  --}}
          <p class="checkbox-text--title">{{ user.name }}</p>
          <p class="checkbox-text--description">{{ user.care }}</p>
        </div>
      </label>
    @endeach

    <hr style="margin: 64px">
    <h1 class="title">Congrats!</h1>

    @if(auth.isLoggedIn)
      @each((user, index) in submitUsers)
          <input onclick="unsubmit(this)" type="checkbox" name={{ user.name }} id={{ user.id }} class="checkbox-input"/>
          <label for={{ user.id }} class="checkbox-label-congrats">
            <div class="checkbox-text">
              {{--  <div style="width:320px; height:320px">  --}}
                <figure class="image is-square">
                  <img style="border-radius: 20px;" src={{ user.profileImg }} alt={{ user.name }}>
                </figure>
                {{--  </div>  --}}
              <p class="checkbox-text--title">{{ user.name }}</p>
              <p class="checkbox-text-congrats--description">{{ user.care }}</p>
            </div>
          </label>
      @endeach

      <form onsubmit="return confirm('Do you really want to do that?');" action="{{ `/clear` }}" method="post">
        {{ csrfField() }}
        <button class="button is-danger is-light" type="submit">Clear All</button>
      </form>

      <br>

      <form onsubmit="return confirm('Logout NOW?');" action="{{ `/logout` }}" method="post">
        {{ csrfField() }}
        <button class="button is-info is-outlined" type="submit">Logout</button>
      </form>    
    @else

      @each((user, index) in submitUsers)
          <input type="checkbox" name={{ user.name }} id={{ user.id }} class="checkbox-input"/>
          <label for={{ user.id }} class="checkbox-label-congrats">
            <div class="checkbox-text">
              {{--  <div style="width:320px; height:320px">  --}}
                <figure class="image is-square">
                  <img style="border-radius: 20px;" src={{ user.profileImg }} alt={{ user.name }}>
                </figure>
                {{--  </div>  --}}
              <p class="checkbox-text--title">{{ user.name }}</p>
              <p class="checkbox-text-congrats--description">{{ user.care }}</p>
            </div>
          </label>
      @endeach

      <hr style="margin-bottom: 64px">

      <form action="{{ `/login` }}" method="get">
        {{ csrfField() }}
        <button class="button is-link" type="submit">Admin</button>
      </form>    
    @endif

  </body>
  <script>
    function copyToClipboard() {
      const p = document.getElementById('unsubmit-reminder')//.innerHTML
      /* Copy the text inside the text field */
      navigator.clipboard.writeText(p.textContent);
    }

    function submit(elem) {
      console.log(elem.id)
      if (confirm(`${elem.name}?`) == true) {
        var xhr = new XMLHttpRequest()
        var url = "/home";
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                console.log('yes');
                location.reload()
            }
        };
        var data = JSON.stringify({"id": elem.id, "submit": true});
        xhr.send(data);
      } 
      
    }

    function unsubmit(elem) {
      console.log(elem.id)
      if (confirm(`${elem.name}?`) == true) {
        var xhr = new XMLHttpRequest()
        var url = "/home";
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
              location.reload()
            }
        };
        var data = JSON.stringify({"id": elem.id, "submit": false});
        xhr.send(data);
      } 
      
    }
  </script>
</html>